lula-version: ">= v0.16.0"
metadata:
  name: load-balancer-https-check
  description: Validates that the application load balancer is configured to use HTTPS with a strong encryption cipher suite.
  uuid: 92f7e731-cbe4-4078-93e7-814cfb1f9469
domain:
  type: file
  file-spec:
    filepaths:
    - name: load-balancer-terraform
      path: https://raw.githubusercontent.com/cds-snc/cds-superset/refs/heads/main/terragrunt/aws/load_balancer.tf
      parser: hcl2
provider:
  type: kyverno
  kyverno-spec:
    policy:
      apiVersion: json.kyverno.io/v1alpha1
      kind: ValidatingPolicy
      metadata:
        name: load-balancer-https-check
      spec:
        rules:
        - name: protocol-is-https
          assert:
            all:
            - check:
                load-balancer-terraform:
                  resource:
                    aws_lb_listener:
                      superset:
                        port: "443"
                        protocol: "HTTPS"
                        ssl_policy: "ELBSecurityPolicy-TLS13-1-3-FIPS-2023-04"